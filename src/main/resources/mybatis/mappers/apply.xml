<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
						
	<mapper namespace="com.kosta.clothes.dao.ApplyDAO">
<!-- 개인이 개인에게 무료나눔/개인판매 신청(wapply 테이블) -->
	<insert id="insertSwapply" parameterType="Wapply">
	<selectKey keyProperty="wno" resultType="Integer" order="BEFORE">
		<![CDATA[
			select wapply_seq.nextval from dual
		]]>
	</selectKey>		
		<![CDATA[
			insert into wapply (wno,wuserno,sno,regdate)
			values (wapply_seq.nextval,#{wuserno},#{sno},sysdate)
		]]>
	</insert>
	
	<select id="getSapply" parameterType="map" resultType="Wapply">
		<![CDATA[
			select wuserno,sno
			from wapply
			where wuserno=#{wuserno} and sno=#{sno}
		]]>
	</select>
	
	<insert id="insertIwapply" parameterType="Wapply">
	<selectKey keyProperty="wno" resultType="Integer" order="BEFORE">
		<![CDATA[
			select wapply_seq.nextval from dual
		]]>
	</selectKey>		
		<![CDATA[
			insert into wapply (wno,wuserno,ino,regdate)
			values (#{wno},#{wuserno},#{ino},sysdate)
		]]>
	</insert>

	<select id="getIapply" parameterType="map" resultType="Wapply">
		<![CDATA[
			select wuserno,ino
			from wapply
			where wuserno=#{wuserno} and ino=#{ino}
		]]>
	</select>
	 
<!-- 개인이 업체에게 수거신청(apply 테이블) -->
	<insert id="insertapply" parameterType="apply">
	<selectKey keyProperty="ano" resultType="Integer" order="BEFORE">
		<![CDATA[
			select apply_seq.nextval from dual
		]]>
	</selectKey>		
		<![CDATA[
			insert into apply (ano,aname,aphone,weight,aaddress,apickup,userno,bno,astatus)
<<<<<<< HEAD
			values (#{ano},#{aname},#{aphone},#{weight},#{aaddress}, #{apickup},#{userno},#{bno},#{astatus})
=======
			values (#{ano},#{aname},#{aphone},#{weight},#{aaddress}, #{apickup},#{userno},#{bno},'수거대기')
>>>>>>> ecccd0b54fed8e653088a1afd8454deab1c2a04b
		]]>
	</insert>
	

	<!-- 신청 폼 개수 -->
	<select id="applycount"  parameterType="Integer" resultType="Integer">
			<![CDATA[
				select count(*) from apply where bno=#{bno}
			]]>
		</select>
		
		
	<!-- 거래 상태 카운트 -->
	<select id="astatuscount"  parameterType="Integer" resultType="Integer">
			<![CDATA[
				select count(*) from apply where bno=#{bno} and astatus='수거중'
			]]>
		</select>
		
	<select id="bstatuscount"  parameterType="Integer" resultType="Integer">
			<![CDATA[
				select count(*) from apply where bno=#{bno} and astatus='수거거절'
			]]>
		</select>
		
	<select id="cstatuscount"  parameterType="Integer" resultType="Integer">
			<![CDATA[
				select count(*) from apply where bno=#{bno} and astatus='수거완료'
			]]>
		</select>

	
	<!-- 사용자 -> 사업자에게 신청한 목록 리스트  -->
	<select id="getBapply" parameterType="Integer" resultType="apply">
		<![CDATA[
			SELECT * FROM apply WHERE bno = #{bno}
		]]>
	</select>
	
	<!-- 사용자가 신청한 목록 -->
	<select id="getUapply" parameterType="Integer" resultType="apply">
		<![CDATA[
			SELECT * FROM apply a, business b 
			WHERE a.bno = b.bno and userno = #{userno}
		]]>
	</select>
</mapper>	