<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.kosta.clothes.dao.BusinessDAO">
	<select id="selectBusiness" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT *
			FROM business 
			WHERE baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%'
		]]>
	</select>
	
	<select id="selectBusiness1" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT *
			FROM BUSINESS b , LIKES l   
			WHERE b.BNO = l.BNO AND baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%' AND userno=#{userno}
		]]>
	</select>
	
	<select id="selectBusiness2" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT b.BNO,b.BNAME,avg(r.rSTAR) AS bstar,count(r.RSTAR) AS reviewcount, b.BADDRESS, b.BUSINESSID, b.BDETAILADD, b.BKAKAOID, b.BPHONE, b.BNUMBER
			FROM BUSINESS b , review r
			WHERE b.BNO = r.BNO AND baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%'			
			GROUP BY b.BNO,b.BNAME,r.bno, b.BADDRESS, b.BUSINESSID,b.BDETAILADD,b.BKAKAOID,b.BPHONE, b.BNUMBER
			ORDER BY reviewcount desc			
		]]>
	</select>
	
	<select id="selectBusiness4" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT b.BNO,b.BNAME,avg(r.rSTAR) AS bstar,count(r.RSTAR) AS reviewcount, b.BADDRESS, b.BUSINESSID, b.BDETAILADD, b.BKAKAOID, b.BPHONE, b.BNUMBER
			FROM BUSINESS b , review r
			WHERE b.BNO = r.BNO AND baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%'			
			GROUP BY b.BNO,b.BNAME,r.bno, b.BADDRESS, b.BUSINESSID,b.BDETAILADD,b.BKAKAOID,b.BPHONE, b.BNUMBER
			ORDER BY bstar desc			
		]]>
	</select>
	
	<select id="selectBusiness5" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT b.BNO,b.BNAME,avg(r.rSTAR) AS bstar,count(r.RSTAR) AS reviewcount, b.BADDRESS, b.BUSINESSID, b.BDETAILADD, b.BKAKAOID, b.BPHONE, b.BNUMBER
			FROM BUSINESS b , review r
			WHERE b.BNO = r.BNO AND baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%'			
			GROUP BY b.BNO,b.BNAME,r.bno, b.BADDRESS, b.BUSINESSID,b.BDETAILADD,b.BKAKAOID,b.BPHONE, b.BNUMBER
			ORDER BY bstar asc			
		]]>
	</select>
	<!-- 경계선 -->
	<select id="selectBusiness3" resultType="Business" parameterType="map">
		<![CDATA[
			SELECT b.BNO,b.BNAME,avg(r.rSTAR) AS bstar,count(r.RSTAR) AS reviewcount, b.BADDRESS, b.BUSINESSID, b.BDETAILADD, b.BKAKAOID, b.BPHONE, b.BNUMBER, l.LIKESCHECK 
			FROM BUSINESS b ,LIKES l, review r   
			WHERE b.BNO = l.BNO AND b.BNO = r.BNO AND baddress LIKE '%'||#{sido}||'%' AND baddress LIKE '%'||#{sigungu}||'%' AND l.userno =#{userno}
			GROUP BY b.BNO,b.BNAME,r.bno,l.BNO, b.BADDRESS, b.BUSINESSID,b.BDETAILADD,b.BKAKAOID,b.BPHONE, b.BNUMBER, l.LIKESCHECK
			<if test='category.equals("review")'>
				ORDER BY reviewcount desc
			</if>
			<if test='category.equals("high")'>
				ORDER BY bstar desc
			</if>
			<if test='category.equals("low")'>
				ORDER BY bstar asc
			</if>
		]]>
	</select>
	
</mapper>