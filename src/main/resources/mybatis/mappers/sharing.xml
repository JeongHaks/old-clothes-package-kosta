<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
						
<mapper namespace="com.kosta.clothes.dao.SharingDAO">
	<select id="getNextSharingNo" resultType="Integer">
		<![CDATA[
			select sharing_seq.nextval from dual
		]]>
	</select>
	
	<insert id="insertSharing" parameterType="sharing">
		<![CDATA[
			insert into sharing(sno,stitle,scontent,sstatus,sfileids,sdealType,
			addressCity,addressTown,userno,regDate)
			values (#{sno},#{stitle},#{scontent},#{sstatus},#{sfileids,jdbcType=VARCHAR},
			#{sdealType},#{addressCity},#{addressTown},#{userno},sysdate)
	
		]]>
	</insert>
	
	<select id="selectSharing" parameterType="Integer" resultType="sharing">
		<![CDATA[
			select u.nickname as sname, sno, stitle, scontent, sfileids, ai, likes, applycount, s.userno 
			from users u, sharing s 
			where u.userno = s.userno and sno = #{sno}		
		]]>
	</select>
	
	<update id="updateSharing" parameterType="sharing">
		<![CDATA[
			update sharing set stitle=#{stitle},scontent=#{scontent},sfileids=#{sfileids,jdbcType=VARCHAR},
			sdealType=#{sdealType},addressCity=#{addressCity},addressTown=#{addressTown}
			where sno=#{sno}
					
		]]>
	</update>
	
	<update id="sharinglikes" parameterType="Long">
		<![CDATA[
			UPDATE LIKES SET LIKESCHECK = LIKESCHECK + 1
			WHERE sno=#{sno} AND userno=#{userno}
		]]>
	</update>
		
	<select id="getByUserid" parameterType="String" resultType="sharing">
		<![CDATA[
			select *
			from users u, sharing s 
			where u.userno = s.userno and userid=#{userid}
		]]>
	</select>
	
	<select id="selectSharingList" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing order by sno desc)

			where rownum <= 6
		]]>
	</select>
	
	<select id="selectSharingSearchedList" resultType="sharing" parameterType="String">
		<![CDATA[
			select * from ( select * from sharing where (stitle||scontent||sstatus||addressCity||addressTown||ai||sdealType||regdate) like '%'||#{kwd}||'%' order by sno desc )
			where rownum <= 6
		]]>
	</select>
	
	<select id="infiniteScrollDown" parameterType="Integer" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing where sno <=#{snoToStart} order by sno desc)

			where rownum <= 6
		]]>
	</select>
	
	<select id="searchedInfiniteScrollDown" parameterType="map" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing where sno <=#{sno} and (stitle||scontent||sstatus||addressCity||addressTown||ai||sdealType||regdate) like '%'||#{kwd}||'%' order by sno desc)
			where rownum <= 6
		]]>
	</select>

</mapper>

















