<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
						
<mapper namespace="com.kosta.clothes.dao.SharingDAO">
	<select id="getNextSharingNo" resultType="Integer">
		<![CDATA[
			select sharing_seq.nextval from dual
		]]>
	</select>
	
	<insert id="insertSharing" parameterType="sharing">
		<![CDATA[
			insert into sharing(sno,stitle,scontent,sstatus,sfileids,sdealType,
			addressCity,addressTown,userno,regDate)
			values (#{sno},#{stitle},#{scontent},#{sstatus},#{sfileids,jdbcType=VARCHAR},
			#{sdealType},#{addressCity},#{addressTown},#{userno},sysdate)
	
		]]>
	</insert>
	
	<select id="selectSharing" parameterType="Integer" resultType="sharing">
		<![CDATA[
			select u.nickname as sname, sno, stitle, scontent, sfileids, ai, likes, applycount, s.userno 
			from users u, sharing s 
			where u.userno = s.userno and sno = #{sno}		
		]]>
	</select>
	
	<update id="updateSharing" parameterType="sharing">
		<![CDATA[
			update sharing set stitle=#{stitle},scontent=#{scontent},addressCity=#{addressCity},
			addressTown=#{addressTown},sfileids=null
			where sno=#{sno}
		]]>
	</update>
	
	<update id="updateSfileids" parameterType="sharing">
		<![CDATA[
			update sharing set sfileids=#{sfileids}
			where sno=#{sno}
		]]>
	</update>
	
	<delete id="deleteSharing" parameterType="Integer">
		<![CDATA[
			delete from sharing where sno=#{sno}
		]]>
	</delete>
	
	<insert id="insertSlikes" parameterType="Likes">
	<selectKey keyProperty="likesno" resultType="Integer" order="BEFORE">
		<![CDATA[
			select likes_seq.nextval from dual
		]]>
	</selectKey>		
		<![CDATA[
			insert into likes(likesno,userno,sno)
			values (#{likesno},#{userno},#{sno})
		]]>
	</insert>
	
	<update id="updateSharingLikes" parameterType="sharing">
		<![CDATA[
			update sharing set likes = likes + 1
			where sno=#{sno}
		]]>
	</update>

	<update id="likesUp" parameterType="likes">
		<![CDATA[
			update likes set likescheck = likescheck + 1
			where sno=#{sno} and userno=#{userno}
		]]>
	</update>
		
	<update id="likesDown" parameterType="likes">
		<![CDATA[
			update likes set likescheck = 0
			where sno=#{sno} and userno=#{userno}
		]]>
	</update>
	
	<delete id="deleteLikes" parameterType="Integer">
		<![CDATA[
			delete from likes where sno=#{sno}
		]]>
	</delete>
		
	<select id="getByUserid" parameterType="String" resultType="sharing">
		<![CDATA[
			select *
			from users u, sharing s 
			where u.userno = s.userno and userid=#{userid}
		]]>
	</select>
	
	<select id="selectSharingList" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing order by sno desc)

			where rownum <= 6
		]]>
	</select>
	
	<select id="selectSharingSearchedList" resultType="sharing" parameterType="String">
		<![CDATA[
			select * from ( select * from sharing where (stitle||scontent||sstatus||addressCity||addressTown||ai||sdealType||regdate) like '%'||#{kwd}||'%' order by sno desc )
			where rownum <= 6
		]]>
	</select>
	
	<select id="infiniteScrollDown" parameterType="Integer" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing where sno <=#{snoToStart} order by sno desc)

			where rownum <= 6
		]]>
	</select>
	
	<select id="searchedInfiniteScrollDown" parameterType="map" resultType="sharing">
		<![CDATA[
			select * from ( select * from sharing where sno <=#{sno} and (stitle||scontent||sstatus||addressCity||addressTown||ai||sdealType||regdate) like '%'||#{kwd}||'%' order by sno desc)
			where rownum <= 6
		]]>
	</select>

</mapper>

















